@using Datis
@model Datis.Data.RepairMetadata
@{
    ViewBag.Title = "فرم تعمیرات";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    @*<link rel="stylesheet" type="text/css" href="~/Content/shop/js/bootstrap/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="~/Content/shop/css/font-awesome/css/font-awesome.min.css" />*@
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/stylesheet.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/owl.carousel.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/owl.transitions.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/responsive.css" />
    <style type="text/css">
        .navbar.navbar-grey-light {
            background-color: transparent;
            border-color: transparent;
        }

            .navbar.navbar-grey-light .navbar-collapse {
                background-color: transparent;
            }

            .navbar.navbar-grey-light .navbar-nav > li > a {
                background-color: transparent;
            }

        .carousel li {
            margin-right: 0;
        }

        .logo a.brand {
            height: 45px;
        }

            .logo a.brand img {
                height: 45px;
            }

        .navbar-nav > li > a > span {
            font-size: 12px;
        }

        .logo {
            margin-top: 0px;
        }

        .navbar {
            margin-bottom: 3px;
        }

            .navbar.navbar-grey-light .dropdown-menu li.dropdown-header {
                color: #e10e4f;
            }

        @@media only screen and (max-width: 991px) {
            header .logo {
                margin-top: 0px;
            }

            .navbar {
                margin-bottom: 0px;
            }
        }

        a, p, h3 {
            font-family: 'BaharFont','Open Sans';
        }

        #cat_accordion {
            direction: rtl;
        }

        p.description {
            font-size: 16px;
            font-style: normal;
        }

        .product-list .product-thumb h4 a {
            font-size: 22px;
        }
        .field-validation-error {
            direction: rtl;
            color: red;
        }
        .validation-summary-errors ul {
            list-style: none;
        }
        .ui-menu {
            background-color: white;
        }
        label {
            direction: rtl;
        }
    </style>
}
@section header{
    <div class="full_page_photo no_photo">
        @Html.Raw(Helpers.GetHeaderIamge("Repair"))
        <div class="container">
            <div class="hgroup">
                <div class="hgroup_title animated bounceInUp skincolored">
                    <div class="container">
                        <h1>خدمات پس از فروش</h1>
                    </div>
                </div>
                <div class="hgroup_subtitle animated bounceInUp ">
                    <div class="container">
                        <p>همیشه حق با مشتری است </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div class="container" style=" margin-top: 10px;">
    <!-- Breadcrumb Start-->
    <ul class="breadcrumb" style="direction:rtl;">
        <li itemscope itemtype=""><a href="@Url.Action("Index", "Home")" itemprop="url"><span itemprop="title"><i class="fa fa-home"></i></span></a></li>
        <li itemscope itemtype=""><a href="@Url.Action("Repair", "AfterSaleServices")" itemprop="url"><span itemprop="title">فرم تعمیرات</span></a></li>
    </ul>
    <!-- Breadcrumb End-->
    <div class="row">
        <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 " style="text-align: center;margin-bottom: 100px;">
            <h2 class="section_header fancy centered">فرم تعمیرات و مرجوعی<small></small></h2>
            <div class="container">
                <section>
                    <div class="row">
                        <div class="office_address col-sm-6 col-md-4">
                            <div class="team_member">
                                <img src="~/Content/Theme/images/logo.png" alt="logo">
                                <h5>شرکت پویش رایان داتیس</h5>
                                <small>نمایندگی مانیتورهای صنعتی و تجاری LG و دوربین های مداربسته Briton</small><br>
                                <address>
                                    ایران تهران<br>
                                    خیابان دماوند - منطقه صنعتی اتحاد - خیابان اتحاد - خیابان اول شرقی - پلاک 1
                                    <br>
                                </address>
                                <abbr title="Phone">تلفن:</abbr> 22566223<br>
                                <abbr title="Phone">تلفن:</abbr> 22768667<br>
                                <abbr title="Phone">ایمیل:</abbr> <a href="mailto:#">info@datisint.com</a>
                            </div>
                        </div>
                        <div class="contact_form col-sm-6 col-md-8">
                            @using (Html.BeginForm())
                            {
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.TamirOrMarjoo)
                                        @Html.DropDownListFor(m => m.TamirOrMarjoo, (List<SelectListItem>)ViewBag.tamirmarjoo, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.TamirOrMarjoo)
                                        @*<input name="name" id="name" class="form-control" type="text" value="">*@
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.NameSherkat)
                                        @Html.TextBoxFor(m => m.NameSherkat, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.NameSherkat)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.NameMasool)
                                        @Html.TextBoxFor(m => m.NameMasool, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.NameMasool)
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Ostan)
                                        @Html.DropDownListFor(m => m.Ostan, (List<SelectListItem>)ViewBag.states, "انتخاب استان", new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Ostan)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Shahrestan)
                                        @Html.DropDownListFor(m => m.Shahrestan, new List<SelectListItem>(), "انتخاب شهر", new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Shahrestan)
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.CodePosti)
                                        @Html.TextBoxFor(m => m.CodePosti, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.CodePosti)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Tel)
                                        @Html.TextBoxFor(m => m.Tel, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Tel)
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Mobile)
                                        @Html.TextBoxFor(m => m.Mobile, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Mobile)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Email)
                                        @Html.TextBoxFor(m => m.Email, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Email)
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.ModelDastgah)
                                        @Html.TextBoxFor(m => m.ModelDastgah, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.ModelDastgah)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.ShomareSerialDastgah)
                                        @Html.TextBoxFor(m => m.ShomareSerialDastgah, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.ShomareSerialDastgah)
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.ShomareFactor)
                                        @Html.TextBoxFor(m => m.ShomareFactor, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.ShomareFactor)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.FactorDate)
                                        @Html.TextBoxFor(m => m.FactorDate, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.FactorDate)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        @Html.LabelFor(m => m.Address)
                                        @Html.TextBoxFor(m => m.Address, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Address)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        @Html.LabelFor(m => m.Eshkal)
                                        @Html.TextAreaFor(m => m.Eshkal, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Eshkal)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <label>کد امنیتی</label>
                                        <input name="captcha" id="Captcha" class="form-control" type="text" value="">
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        <div>
                                            <label>حاصل جمع؟</label>
                                            <div style="width: 100%; clear: both; text-align: right;">
                                                <a class="ref"><i class="fa fa-refresh" aria-hidden="true" style="vertical-align: middle;height: 30px; cursor:pointer"></i></a>
                                                <img alt="Captcha" id="imgcpatcha" src="@Url.Action("CaptchaImage", "Captcha", new { prefix = "Repair" })" style="" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <p id="res"></p>
                                        <a id="submit_btn" class="btn btn-primary" name="submit">ثبت درخواست</a> <span id="notice" class="alert alert-warning alert-dismissable hidden" style="margin-left:20px;"></span>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
@section scripts{

    <script type="text/javascript" src="~/Content/shop/js/custom.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.maskedinput.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script>
        $(function () {
            $('#submit_btn').click(function () {
                var BASE_URL = '@Url.Content("~/")';
                $.ajax({
                    url: '@Url.Action("SaveRepair", "AfterSaleServices")',
                    type: 'GET',
                    dataType: 'json',
                    data:
                    {
                        TamirOrMarjoo: $('#TamirOrMarjoo').val(),
                        NameSherkat: $('#NameSherkat').val(),
                        NameMasool: $('#NameMasool').val(),
                        Ostan: $('#Ostan').val(),
                        Shahrestan: $('#Shahrestan').val(),
                        CodePosti: $('#CodePosti').val(),
                        Tel: $('#Tel').val(),
                        Mobile: $('#Mobile').val(),
                        Email: $('#Email').val(),
                        ModelDastgah: $('#ModelDastgah').val(),
                        ShomareSerialDastgah: $('#ShomareSerialDastgah').val(),
                        ShomareFactor: $('#ShomareFactor').val(),
                        FactorDate: $('#FactorDate').val(),
                        Address: $('#Address').val(),
                        Eshkal: $('#Eshkal').val(),
                        Captcha: $('#Captcha').val()
                    },
                    success: function (data) {
                        if (data.success) {
                            $('#res').html(data.message);
                            $('#res').css('color', 'green');
                            $("form :input").each(function () {
                                var input = $(this);
                                input.css('border-color', 'rgb(204, 204, 204)');
                            });


                        }
                        else {

                            var errors = JSON.parse(data.message);
                            $('#res').html('');
                            var i, it;
                            $.each(errors, function (index, item) {
                                i = index;
                                it = item;
                                $("form :input").each(function () {

                                    var input = $(this);
                                    if (input.attr('id') == errors[i].key) {
                                        input.css('border-color', 'red');
                                        $('#res').append("<br />" + errors[i].error);
                                    }
                                });
                            });
                            //$('#res').html(data.message);

                            $('#res').css('color', 'red');
                            $('.ref').click();
                        }

                    },
                    error: function (xhr, status, error) {
                    }
                });
            });
            $('.ref').click(function () {
                var BASE_URL = '@Url.Content("~/")';
                var random = new Date();
                $.ajax({
                    url: '@Url.Action("CaptchaImage", "Captcha")',
                    type: 'GET',
                    data:
                    {
                        prefix: "Repair"
                    },
                })
                .done(function (functionResult) {
                    $("#imgcpatcha").attr("src", BASE_URL + "Captcha/CaptchaImage?prefix=Repair");
                });
            });

            var url = '@Url.Action("CityLookup", "AfterSaleServices")'; // Don't hard code your url's!
            var cities = $('#Shahrestan'); // cache it
            $("#Ostan").change(function () {
                var id = $(this).val(); // Use $(this) so you don't traverse the DOM again
                $.getJSON(url, { stateId: id }, function (response) {
                    cities.empty(); // remove any existing options
                    $.each(response, function (index, item) {
                        cities.append('<option value="' + item.Id + '">' + item.Title + '</option>');
                    });
                });
            });

            $('#FactorDate').mask("9999/99/99");

            $("#ModelDastgah")
    .autocomplete({
        source: function (request, response) {
            $.ajax({
                url: '@Url.Action("ProductLookup", "SerialNumber")',
                type: "POST",
                dataType: "json",
                data: { term: request.term },
                success: function (data) {
                    response($.map(data,
                        function (item) {
                            return { label: item.Text, value: item.Value };
                        }));

                }
            });
        },
        select: function (event, ui) {
            event.preventDefault();
            $(this).val(ui.item.label);
            $(this).attr('data-val', ui.item.value);
        },
        change: function (event, ui) {
            if (!ui.item) {
                $(this).val("");
                $(this).attr('data-val', "");
            }
        }
    });
        });
    </script>
}
