@using Datis
@model Datis.Data.SerialNumberMetadata
@{
    ViewBag.Title = "ثبت شماره سریال";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    @*<link rel="stylesheet" type="text/css" href="~/Content/shop/js/bootstrap/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="~/Content/shop/css/font-awesome/css/font-awesome.min.css" />*@
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/stylesheet.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/owl.carousel.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/owl.transitions.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/shop/css/responsive.css" />
    <style type="text/css">
        .navbar.navbar-grey-light {
            background-color: transparent;
            border-color: transparent;
        }

            .navbar.navbar-grey-light .navbar-collapse {
                background-color: transparent;
            }

            .navbar.navbar-grey-light .navbar-nav > li > a {
                background-color: transparent;
            }

        .carousel li {
            margin-right: 0;
        }

        .logo a.brand {
            height: 45px;
        }

            .logo a.brand img {
                height: 45px;
            }

        .navbar-nav > li > a > span {
            font-size: 12px;
        }

        .logo {
            margin-top: 0px;
        }

        .navbar {
            margin-bottom: 3px;
        }

            .navbar.navbar-grey-light .dropdown-menu li.dropdown-header {
                color: #e10e4f;
            }

        @@media only screen and (max-width: 991px) {
            header .logo {
                margin-top: 0px;
            }

            .navbar {
                margin-bottom: 0px;
            }
        }

        a, p, h3 {
            font-family: 'BaharFont','Open Sans';
        }

        #cat_accordion {
            direction: rtl;
        }

        p.description {
            font-size: 16px;
            font-style: normal;
        }

        .product-list .product-thumb h4 a {
            font-size: 22px;
        }

        .validation-summary-errors {
            direction: rtl;
            color: red;
        }

            .validation-summary-errors ul {
                list-style: none;
            }

        .ui-menu {
            background-color: white;
        }

            .ui-menu .ui-menu-item li a {
                color: #96f226;
                border-radius: 0px;
                border: 1px solid #454545;
                font-size: 18px;
            }
            label {
                direction: rtl
            }
        #res {
            direction: rtl;
        }
    </style>

}
@section header{
    <div class="full_page_photo no_photo">
        @Html.Raw(Helpers.GetHeaderIamge("SerialNumber"))
        <div class="container">
            <div class="hgroup">
                <div class="hgroup_title animated bounceInUp skincolored">
                    <div class="container">
                        <h1>ثبت شماره سریال</h1>
                    </div>
                </div>
                <div class="hgroup_subtitle animated bounceInUp ">
                    <div class="container">
                        <p>محصولات شرکت پویش رایان داتیس</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div class="container" style=" margin-top: 10px;">
    <!-- Breadcrumb Start-->
    <ul class="breadcrumb" style="direction:rtl;">
        <li itemscope itemtype=""><a href="@Url.Action("Index", "Home")" itemprop="url"><span itemprop="title"><i class="fa fa-home"></i></span></a></li>
        <li itemscope itemtype=""><a href="@Url.Action("Repair", "AfterSaleServices")" itemprop="url"><span itemprop="title">فرم درخواست اخذ نمایندگی</span></a></li>
    </ul>
    <!-- Breadcrumb End-->
    <div class="row">
        <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 " style="text-align: center;margin-bottom: 100px;">
            <h2 class="section_header fancy centered">فرم ثبت شماره سریال<small></small></h2>
            <div class="container">
                <section>
                    <div class="row">
                        <div class="office_address col-sm-6 col-md-4">
                            <div class="team_member">
                                <img src="~/Content/Theme/images/logo.png" alt="logo">
                                <h5>شرکت پویش رایان داتیس</h5>
                                <small>نمایندگی مانیتورهای صنعتی و تجاری LG و دوربین های مداربسته Briton</small><br>
                                <address>
                                    ایران تهران<br>
                                    پاسداران خیابان هاتف اصفهانی بن بست پریسا پلاک 5
                                    <br>
                                </address>
                                <abbr title="Phone">تلفن:</abbr> 74856-021<br>
                                <!-- <abbr title="Phone">تلفن:</abbr> 22768667<br> -->
                                <abbr title="Phone">ایمیل:</abbr> <a href="mailto:#">info@datisint.com</a>
                            </div>
                        </div>
                        <div class="contact_form col-sm-6 col-md-8" id="tobind">
                            @using (Html.BeginForm("Index", "SerialNumber", FormMethod.Post, new { enctype = "multipart/form-data", id = "serialForm" }))
                            {
                                @Html.AntiForgeryToken()
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">

                                        @Html.LabelFor(m => m.Name)
                                        @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
                                        @*<input name="name" id="name" class="form-control" type="text" value="">*@
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.LastName)
                                        @Html.TextBoxFor(m => m.LastName, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Email)
                                        @Html.TextBoxFor(m => m.Email, new { @class = "form-control" })
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Mobile)
                                        @Html.TextBoxFor(m => m.Mobile, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Product)
                                        @Html.TextBoxFor(m => m.Product, new { @class = "form-control", data_val = ""  })
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.Serial)
                                        @Html.TextBoxFor(m => m.Serial, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        @Html.LabelFor(m => m.BuyDate)
                                        @Html.TextBoxFor(m => m.BuyDate, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        @Html.LabelFor(m => m.Description)
                                        @Html.TextBoxFor(m => m.Description, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <label>کد امنیتی</label>
                                        <input name="captcha" id="Captcha" class="form-control" type="text" value="">
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        <div>
                                            <label>حاصل جمع؟</label>
                                            <div style="width: 100%; clear: both; text-align: right;">
                                                <a class="ref"><i class="fa fa-refresh" aria-hidden="true" style="vertical-align: middle;height: 30px; cursor:pointer"></i></a>
                                                <img alt="Captcha" id="imgcpatcha" src="@Url.Action("CaptchaImage", "Captcha", new { prefix = "SerialNumber" })" s style="" />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row" id="res">


                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <a class="btn btn-primary" data-bind="click:addSerial">افزودن شماره سریال</a>

                                        @*<a id="submit_btn" class="btn btn-primary" name="submit">ارسال درخواست</a>*@ <span id="notice" class="alert alert-warning alert-dismissable hidden" style="margin-left:20px;"></span>
                                    </div>
                                </div>
                            }
                            <div class="row">
                                <div class="col-sm-12 col-md-12">
                                    <table class="table" style="direction:rtl">
                                        <thead>
                                            <tr>
                                                <td>محصول</td>
                                                <td>سریال</td>
                                                <td>تاریخ خرید</td>
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: serials">
                                            <tr>
                                                <td data-bind="text: Product"></td>
                                                <td data-bind="text: Serial"></td>
                                                <td data-bind="text: BuyDate"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script type="text/javascript" src="~/Content/shop/js/jquery.easing-1.3.min.js"></script>
    <script type="text/javascript" src="~/Content/shop/js/jquery.dcjqaccordion.min.js"></script>
    <script type="text/javascript" src="~/Content/shop/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="~/Content/shop/js/custom.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.maskedinput.min.js"></script>
    <script>
        $(function() {
            $('.ref')
                .click(function() {
                    var BASE_URL = '@Url.Content("~/")';
                    var random = new Date();
                    $.ajax({
                            url: '@Url.Action("CaptchaImage", "Captcha")',
                            type: 'GET',
                            data:
                            {
                                prefix: "SerialNumber"
                            },
                        })
                        .done(function(functionResult) {
                            $("#imgcpatcha").attr("src", BASE_URL + "Captcha/CaptchaImage?prefix=SerialNumber");
                        });
                });

            $('#BuyDate').mask("1399/99/99");

            $("#Product")
                .autocomplete({
                    source: function(request, response) {
                        $.ajax({
                            url: '@Url.Action("ProductLookup", "SerialNumber")',
                            type: "POST",
                            dataType: "json",
                            data: { term: request.term },
                            success: function(data) {
                                response($.map(data,
                                    function(item) {
                                        return { label: item.Text, value: item.Value };
                                    }));

                            }
                        });
                    },
                    //messages: {
                    //    noResults: 'No results found.',
                    //    results: function(count) {
                    //        return count + (count > 1 ? ' results' : ' result ') + ' found';
                    //    }
                    //},
                    select: function(event, ui) {
                        event.preventDefault();
                        $(this).val(ui.item.label);
                        $(this).attr('data-val', ui.item.value);
                    },
                    change: function(event, ui) {
                        if (!ui.item) {
                            //http://api.jqueryui.com/autocomplete/#event-change -
                            // The item selected from the menu, if any. Otherwise the property is null
                            //so clear the item for force selection
                            $(this).val("");
                            $(this).attr('data-val', "");
                        }
                    }
                });
        });

        function serialnumber(name, lastName, email, mobile, product, serial, description, buyDate) {
            var self = this;
            self.Name = ko.observable(name);
            self.LastName = ko.observable(lastName);
            self.Mobile = ko.observable(mobile);
            self.Product = ko.observable(product);
            self.Serial = ko.observable(serial);
            self.Description = ko.observable(description);
            self.BuyDate = ko.observable(buyDate);
            self.Email = ko.observable(email);
        }

        function serialsViewModel() {
            var self = this;
            self.serials = ko.observableArray([]);
            self.addSerial = function() {
                $.ajax({
                    url: '@Url.Action("Save", "SerialNumber")',
                    data: {
                        'Name': $("#Name").val(),
                        'LastName': $("#LastName").val(),
                        'Email': $("#Email").val(),
                        'Mobile': $("#Mobile").val(),
                        'Product': $("#Product").attr('data-val'),
                        'Serial': $("#Serial").val(),
                        'Description': $("#Description").val(),
                        'BuyDate': $("#BuyDate").val(),
                        'Captcha': $('#Captcha').val()
                    },
                    contentType: "application/json; charset=utf-8",
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        if (data.success) {
                            $('#res').html(data.message);
                            $('#res').css('color', 'green');
                            self.serials
                                .push(new serialnumber(data.savedSerial.Name,
                                    data.savedSerial.LastName,
                                    data.savedSerial.Email,
                                    data.savedSerial.Mobile,
                                    data.savedSerial.Product,
                                    data.savedSerial.Serial,
                                    data.savedSerial.Description,
                                    data.savedSerial.BuyDate));
                            $("#serialForm").find("input[type=text], textarea").val("");
                            $('.ref').click();
                        } else {
                            $('#res').html(data.message);
                            $('#res').css('color', 'red');
                            $('.ref').click();
                        }
                    }
                });
            };
        }

        ko.applyBindings(new serialsViewModel(), document.getElementById("tobind"));
    </script>
}
