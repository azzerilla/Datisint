@using Datis
@model Datis.Data.OrderMetadata
@{
    ViewBag.Title = "سفارش آنلاین";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" type="text/css" href="~/Content/shop/css/stylesheet.css" />
<link rel="stylesheet" type="text/css" href="~/Content/shop/css/responsive.css" />
<link href="~/Content/shop/css/kendo.common-bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/shop/css/kendo.nova.min.css" rel="stylesheet" />
<link href="~/Content/shop/css/kendo.rtl.min.css" rel="stylesheet" />
<link type="text/css" href="~/Content/shop/css/kendo.nova.mobile.min.css" rel="stylesheet" />
<style type="text/css">
    .navbar.navbar-grey-light {
        background-color: transparent;
        border-color: transparent;
    }

        .navbar.navbar-grey-light .navbar-collapse {
            background-color: transparent;
        }

        .navbar.navbar-grey-light .navbar-nav > li > a {
            background-color: transparent;
        }

    .carousel li {
        margin-right: 0;
    }

    .logo a.brand {
        height: 45px;
    }

        .logo a.brand img {
            height: 45px;
        }

    .navbar-nav > li > a > span {
        font-size: 12px;
    }

    .logo {
        margin-top: 0px;
    }

    .navbar {
        margin-bottom: 3px;
    }

        .navbar.navbar-grey-light .dropdown-menu li.dropdown-header {
            color: #e10e4f;
        }

    @@media only screen and (max-width: 991px) {
        header .logo {
            margin-top: 0px;
        }

        .navbar {
            margin-bottom: 0px;
        }
    }

    a, p, h3 {
        font-family: 'BaharFont','Open Sans';
    }

    #cat_accordion {
        direction: rtl;
    }

    p.description {
        font-size: 16px;
        font-style: normal;
    }

    .product-list .product-thumb h4 a {
        font-size: 22px;
    }

    .product-list .product-thumb h4 a {
        font-size: 22px;
    }

    .field-validation-error {
        direction: rtl;
        color: red;
    }

    .validation-summary-errors ul {
        list-style: none;
    }

    .ui-menu {
        background-color: white;
    }

    label {
        direction: rtl;
    }
</style>

}
@section header{
    <div class="full_page_photo no_photo">
        @Html.Raw(Helpers.GetHeaderIamge("GarrantyStatus"))
        <div class="container">
            <div class="hgroup">
                <div class="hgroup_title animated bounceInUp skincolored">
                    <div class="container">
                        <h1>فرم سفارش آنلاین</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div class="container" style=" margin-top: 10px;">
    <!-- Breadcrumb Start-->
    <ul class="breadcrumb" style="direction:rtl;">
        <li itemscope itemtype=""><a href="@Url.Action("Index","Home")" itemprop="url"><span itemprop="title"><i class="fa fa-home"></i></span></a></li>
        <li itemscope itemtype=""><a href="@Url.Action("Index", "Order")" itemprop="url"><span itemprop="title">فرم سفارش آنلاین</span></a></li>
    </ul>
    <!-- Breadcrumb End-->
    <div class="row">
        <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 " style="text-align: center;margin-bottom: 100px;">
            <h2 class="section_header fancy centered">ثبت سفارش<small></small></h2>
            <div class="container">
                <section>
                    <div class="row">
                        <div class="office_address col-sm-6 col-md-4">
                            <div class="team_member">
                                <img src="~/Content/Theme/images/logo.png" alt="logo">
                                <h5>شرکت پویش رایان داتیس</h5>
                                <small>نمایندگی مانیتورهای صنعتی و تجاری LG و دوربین های مداربسته Briton</small><br>
                                <address>
                                    ایران تهران<br>
                                    پاسداران خیابان هاتف اصفهانی بن بست پریسا پلاک 5
                                    <br>
                                </address>
                                <abbr title="Phone">تلفن:</abbr> 22566223<br>
                                <abbr title="Phone">تلفن:</abbr> 22768667<br>
                                <abbr title="Phone">ایمیل:</abbr> <a href="mailto:#">info@datisint.com</a>
                            </div>
                        </div>
                        <div class="contact_form col-sm-6 col-md-8">
                            <form name="contact_form" id="contact_form" method="post">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <label style=" direction: rtl;">شماره مشتری: </label>
                                        <input disabled="disabled" name="serialNumber" id="sn" class="form-control" type="text" value="@ViewBag.CustNo.ToString()">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <label style=" direction: rtl;">محصول: </label>
                                        <input name="serialNumber" id="product" class="form-control" type="text" value="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-3">
                                        <label style=" direction: rtl;">تعداد: </label>
                                        @Html.TextBoxFor(m => m.Tedad, new { @class = "form-control" })
                                        @Html.ValidationMessageFor(m => m.Tedad)
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <br />
                                        <p id="res"></p>
                                        <a id="submit_btn" class="btn btn-primary" name="submit">ثبت</a> <span id="notice" class="alert alert-warning alert-dismissable hidden" style="margin-left:20px;"></span>
                                    </div>
                                    <div class="col-sm-6 col-md-6"></div>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-6 col-md-6">
                            <div class="k-rtl" id="grid"></div>

                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script type="text/javascript" src="~/Content/shop/js/custom.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Scripts/kendo.all.min.js"></script>

    <script>
        $(function() {
            $('#submit_btn')
                .click(function() {
                    var BASE_URL = '@Url.Content("~/")';
                    $.ajax({
                        url: '@Url.Action("Add", "Order")',
                        type: 'POST',
                        dataType: 'json',
                        data:
                        {
                            ProductId: $('#product').attr('data-val'),
                            Tedad: $('#Tedad').val()
                        },
                        success: function(data) {
                            if (data.success) {
                                $('#res').html(data.message);
                                $('#res').css('color', 'green');
                                $("#grid").data("kendoGrid").dataSource.read();
                                $('#product').val("");
                                $('#product').attr('data-val', "");
                                $('#Tedad').val("");

                            } else {
                                $('#res').html(data.message);
                                $('#res').css('color', 'red');
                            }

                        },
                        error: function(xhr, status, error) {
                        }
                    });
                });
            $("#product")
                .autocomplete({
                    source: function(request, response) {
                        $.ajax({
                            url: '@Url.Action("ProductLookup", "SerialNumber")',
                            type: "POST",
                            dataType: "json",
                            data: { term: request.term },
                            success: function(data) {
                                response($.map(data,
                                    function(item) {
                                        return { label: item.Text, value: item.Value };
                                    }));

                            }
                        });
                    },
                    select: function(event, ui) {
                        event.preventDefault();
                        $(this).val(ui.item.label);
                        $(this).attr('data-val', ui.item.value);
                    },
                    change: function(event, ui) {
                        if (!ui.item) {
                            $(this).val("");
                            $(this).attr('data-val', "");
                        }
                    }
                });
            $("#grid")
                .kendoGrid({
                    dataSource: {
                        transport: {
                            read: "@Url.Action("GetUserOrder", "Order")",
                            destroy: {
                                type: 'POST',
                                url: "@Url.Action("RemoveOrder", "Order")",
                            },
                            parameterMap: function(options, operation) {
                                switch (operation) {
                                case "read":
                                case "destroy":
                                    return options;
                                }
                            }
                        },
                        schema: {
                            model: {
                                id: "Id",
                                fields: {
                                    ProductName: { type: "string" },
                                    Tedad: { type: "string" },
                                    Tarikh: { type: "string" }
                                }
                            }
                        },
                        change: function(e) {
                            if (e.action === "remove") {
                                this.sync();
                            }
                        },
                        pageSize: 20,
                        serverPaging: true,
                        serverFiltering: true,
                        serverSorting: true
                    },
                    height: 550,
                    filterable: true,
                    sortable: true,
                    pageable: true,
                    columns: [
                        {
                            field: "ProductName",
                            title: "نام محصول"
                        }, {
                            field: "Tedad",
                            title: "تعداد"
                        }, {
                            field: "Tarikh",
                            title: "تاریخ ثبت"
                        },
                        { command: [{name : "destroy",text : "حذف" }], title: "عملیات", width: "250px" }
                    ],
                    editable: true,
                    dataBound: function(e) {
                    }
                });
        });
    </script>
}



